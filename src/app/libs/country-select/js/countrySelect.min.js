!function(t){"function"==typeof define&&define.amd?define(["jquery"],function(n){t(n,window,document)}):t(jQuery,window,document)}(function(t,n,i,e){"use strict";function s(n,i){this.element=n,this.options=t.extend({},a,i),this._defaults=a,this.ns="."+o+r++,this._name=o,this.init()}var o="countrySelect",r=1,a={defaultCountry:"",defaultStyling:"inside",onlyCountries:[],preferredCountries:["us","gb"]},u={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90},h=!1;t(n).on("load",function(){h=!0}),s.prototype={init:function(){return this._processCountryData(),this._generateMarkup(),this._setInitialState(),this._initListeners(),this.autoCountryDeferred=new t.Deferred,this._initAutoCountry(),this.autoCountryDeferred},_processCountryData:function(){this._setInstanceCountryData(),this._setPreferredCountries()},_setInstanceCountryData:function(){var n=this;if(this.options.onlyCountries.length){var i=[];t.each(this.options.onlyCountries,function(t,e){var s=n._getCountryData(e,!0);s&&i.push(s)}),this.countries=i}else this.countries=c},_setPreferredCountries:function(){var n=this;this.preferredCountries=[],t.each(this.options.preferredCountries,function(t,i){var e=n._getCountryData(i,!1);e&&n.preferredCountries.push(e)})},_generateMarkup:function(){this.countryInput=t(this.element);var n="country-select";this.options.defaultStyling&&(n+=" "+this.options.defaultStyling),this.countryInput.wrap(t("<div>",{"class":n}));var i=t("<div>",{"class":"flag-dropdown"}).insertAfter(this.countryInput),e=t("<div>",{"class":"selected-flag"}).appendTo(i);this.selectedFlagInner=t("<div>",{"class":"flag"}).appendTo(e),t("<div>",{"class":"arrow"}).appendTo(this.selectedFlagInner),this.countryList=t("<ul>",{"class":"country-list v-hide"}).appendTo(i),this.preferredCountries.length&&(this._appendListItems(this.preferredCountries,"preferred"),t("<li>",{"class":"divider"}).appendTo(this.countryList)),this._appendListItems(this.countries,""),this.countryCodeInput=t("#"+this.countryInput.attr("id")+"_code"),this.countryCodeInput||(this.countryCodeInput=t('<input type="hidden" id="'+this.countryInput.attr("id")+'_code" name="'+this.countryInput.attr("name")+'_code" value="" />'),this.countryCodeInput.insertAfter(this.countryInput)),this.dropdownHeight=this.countryList.outerHeight(),this.countryList.removeClass("v-hide").addClass("hide"),this.countryListItems=this.countryList.children(".country")},_appendListItems:function(n,i){var e="";t.each(n,function(t,n){e+='<li class="country '+i+'" data-country-code="'+n.iso2+'">',e+='<div class="flag '+n.iso2+'"></div>',e+='<span class="country-name">'+n.name+"</span>",e+="</li>"}),this.countryList.append(e)},_setInitialState:function(){var t=!1;this.countryInput.val()&&(t=this._updateFlagFromInputVal());var n=this.countryCodeInput.val();if(n&&this.selectCountry(n),!t){var i;this.options.defaultCountry?(i=this._getCountryData(this.options.defaultCountry,!1),i||(i=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0])):i=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0],this.defaultCountry=i.iso2}},_initListeners:function(){var t=this;this.countryInput.on("keyup"+this.ns,function(){t._updateFlagFromInputVal()});var n=this.selectedFlagInner.parent();n.on("click"+this.ns,function(n){t.countryList.hasClass("hide")&&!t.countryInput.prop("disabled")&&t._showDropdown()}),this.countryInput.on("blur"+this.ns,function(){t.countryInput.val()!=t.getSelectedCountryData().name&&t.setCountry(t.countryInput.val()),t.countryInput.val(t.getSelectedCountryData().name)})},_initAutoCountry:function(){"auto"===this.options.initialCountry?this._loadAutoCountry():(this.selectCountry(this.defaultCountry),this.autoCountryDeferred.resolve())},_loadAutoCountry:function(){t.fn[o].autoCountry?this.handleAutoCountry():t.fn[o].startedLoadingAutoCountry||(t.fn[o].startedLoadingAutoCountry=!0,"function"==typeof this.options.geoIpLookup&&this.options.geoIpLookup(function(n){t.fn[o].autoCountry=n.toLowerCase(),setTimeout(function(){t(".country-select input").countrySelect("handleAutoCountry")})}))},_focus:function(){this.countryInput.focus();var t=this.countryInput[0];if(t.setSelectionRange){var n=this.countryInput.val().length;t.setSelectionRange(n,n)}},_showDropdown:function(){this._setDropdownPosition();var t=this.countryList.children(".active");this._highlightListItem(t),this.countryList.removeClass("hide"),this._scrollTo(t),this._bindDropdownListeners(),this.selectedFlagInner.children(".arrow").addClass("up")},_setDropdownPosition:function(){var i=this.countryInput.offset().top,e=t(n).scrollTop(),s=i+this.countryInput.outerHeight()+this.dropdownHeight<e+t(n).height(),o=i-this.dropdownHeight>e,r=!s&&o?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",r)},_bindDropdownListeners:function(){var n=this;this.countryList.on("mouseover"+this.ns,".country",function(i){n._highlightListItem(t(this))}),this.countryList.on("click"+this.ns,".country",function(i){n._selectListItem(t(this))});var e=!0;t("html").on("click"+this.ns,function(t){e||n._closeDropdown(),e=!1}),t(i).on("keydown"+this.ns,function(t){t.preventDefault(),t.which==u.UP||t.which==u.DOWN?n._handleUpDownKey(t.which):t.which==u.ENTER?n._handleEnterKey():t.which==u.ESC?n._closeDropdown():t.which>=u.A&&t.which<=u.Z&&n._handleLetterKey(t.which)})},_handleUpDownKey:function(t){var n=this.countryList.children(".highlight").first(),i=t==u.UP?n.prev():n.next();i.length&&(i.hasClass("divider")&&(i=t==u.UP?i.prev():i.next()),this._highlightListItem(i),this._scrollTo(i))},_handleEnterKey:function(){var t=this.countryList.children(".highlight").first();t.length&&this._selectListItem(t)},_handleLetterKey:function(n){var i=String.fromCharCode(n),e=this.countryListItems.filter(function(){return t(this).text().charAt(0)==i&&!t(this).hasClass("preferred")});if(e.length){var s,o=e.filter(".highlight").first();s=o&&o.next()&&o.next().text().charAt(0)==i?o.next():e.first(),this._highlightListItem(s),this._scrollTo(s)}},_updateFlagFromInputVal:function(){var n=this,i=this.countryInput.val().replace(/(?=[() ])/g,"\\");if(i){for(var e=[],s=new RegExp("^"+i,"i"),o=0;o<this.countries.length;o++)this.countries[o].name.match(s)&&e.push(this.countries[o].iso2);var r=!1;return t.each(e,function(t,i){n.selectedFlagInner.hasClass(i)&&(r=!0)}),r||(this._selectFlag(e[0]),this.countryCodeInput.val(e[0]).trigger("change")),!0}return!1},_highlightListItem:function(t){this.countryListItems.removeClass("highlight"),t.addClass("highlight")},_getCountryData:function(t,n){for(var i=n?c:this.countries,e=0;e<i.length;e++)if(i[e].iso2==t)return i[e];return null},_selectFlag:function(t){if(!t)return!1;this.selectedFlagInner.attr("class","flag "+t);var n=this._getCountryData(t);this.selectedFlagInner.parent().attr("title",n.name);var i=this.countryListItems.children(".flag."+t).first().parent();this.countryListItems.removeClass("active"),i.addClass("active")},_selectListItem:function(t){var n=t.attr("data-country-code");this._selectFlag(n),this._closeDropdown(),this._updateName(n),this.countryInput.trigger("change"),this.countryCodeInput.trigger("change"),this._focus()},_closeDropdown:function(){this.countryList.addClass("hide"),this.selectedFlagInner.children(".arrow").removeClass("up"),t(i).off("keydown"+this.ns),t("html").off("click"+this.ns),this.countryList.off(this.ns)},_scrollTo:function(t){if(t&&t.offset()){var n=this.countryList,i=n.height(),e=n.offset().top,s=e+i,o=t.outerHeight(),r=t.offset().top,a=r+o,u=r-e+n.scrollTop();if(e>r)n.scrollTop(u);else if(a>s){var h=i-o;n.scrollTop(u-h)}}},_updateName:function(t){this.countryCodeInput.val(t).trigger("change"),this.countryInput.val(this._getCountryData(t).name)},handleAutoCountry:function(){"auto"===this.options.initialCountry&&(this.defaultCountry=t.fn[o].autoCountry,this.countryInput.val()||this.selectCountry(this.defaultCountry),this.autoCountryDeferred.resolve())},getSelectedCountryData:function(){var t=this.selectedFlagInner.attr("class").split(" ")[1];return this._getCountryData(t)},selectCountry:function(t){t&&(t=t.toLowerCase(),this.selectedFlagInner.hasClass(t)||(this._selectFlag(t),this._updateName(t)))},setCountry:function(t){this.countryInput.val(t),this._updateFlagFromInputVal()},destroy:function(){this.countryInput.off(this.ns),this.selectedFlagInner.parent().off(this.ns);var t=this.countryInput.parent();t.before(this.countryInput).remove()}},t.fn[o]=function(n){var i=arguments;if(n===e||"object"==typeof n)return this.each(function(){t.data(this,"plugin_"+o)||t.data(this,"plugin_"+o,new s(this,n))});if("string"==typeof n&&"_"!==n[0]&&"init"!==n){var r;return this.each(function(){var e=t.data(this,"plugin_"+o);e instanceof s&&"function"==typeof e[n]&&(r=e[n].apply(e,Array.prototype.slice.call(i,1))),"destroy"===n&&t.data(this,"plugin_"+o,null)}),r!==e?r:this}},t.fn[o].getCountryData=function(){return c},t.fn[o].setCountryData=function(t){c=t};var c=t.each([{n:"Australia",i:"au"},{n:"Austria",i:"at"},{n:"Belgium",i:"be"},{n:"Brazil",i:"br"},{n:"Bulgaria",i:"bg"},{n:"Canada",i:"ca"},{n:"Chile",i:"cl"},{n:"Colombia",i:"co"},{n:"Croatia",i:"hr"},{n:"Cyprus",i:"cy"},{n:"Czech Republic",i:"cz"},{n:"Denmark",i:"dk"},{n:"Dominican Republic",i:"do"},{n:"El Salvador",i:"sv"},{n:"Estonia",i:"ee"},{n:"Finland",i:"fi"},{n:"France",i:"fr"},{n:"Germany",i:"de"},{n:"Greece",i:"gr"},{n:"Hong Kong",i:"hk"},{n:"Hungary",i:"hu"},{n:"Iceland",i:"is"},{n:"Indonesia",i:"id"},{n:"Ireland",i:"ie"},{n:"Israel",i:"il"},{n:"Italy",i:"it"},{n:"Japan",i:"jp"},{n:"Kenya",i:"ke"},{n:"Latvia",i:"lv"},{n:"Lithuania",i:"lt"},{n:"Luxembourg",i:"lu"},{n:"Malta",i:"mt"},{n:"Mexico",i:"mx"},{n:"Netherlands",i:"nl"},{n:"New Zealand",i:"nz"},{n:"Nigeria",i:"ng"},{n:"Norway",i:"no"},{n:"Panama",i:"pa"},{n:"Peru",i:"pe"},{n:"Philippines",i:"ph"},{n:"Poland",i:"pl"},{n:"Portugal",i:"pt"},{n:"Puerto Rico",i:"pr"},{n:"Romania",i:"ro"},{n:"Slovakia",i:"sk"},{n:"Slovenia",i:"si"},{n:"South Africa",i:"za"},{n:"Spain",i:"es"},{n:"Sweden",i:"se"},{n:"Switzerland",i:"ch"},{n:"Thailand",i:"th"},{n:"United Kingdom",i:"gb"},{n:"United States",i:"us"}],function(t,n){n.name=n.n,n.iso2=n.i,delete n.n,delete n.i})});
